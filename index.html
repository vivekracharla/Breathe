<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindful Breathing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='none' stroke='black' stroke-width='2' /%3E%3Cpath d='M16 14c-1.5 1-3.5 1-5 0' stroke='black' stroke-width='2' /%3E%3Ccircle cx='9' cy='10' r='1' fill='black' /%3E%3Ccircle cx='15' cy='10' r='1' fill='black' /%3E%3C/svg%3E" />
    <style>
        :root {
            --bg-start: #0f172a;
            --bg-end: #1e293b;
            --primary-color: #38bdf8;
            --secondary-color: #d1d5db;
            --highlight-color: #60a5fa;
            --accent-color: #4ade80;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--secondary-color);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Animated Background */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #1f2937, #374151, #1f2937, #4b5563);
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite;
        }

        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .breathing-container {
            background-color: rgba(30, 41, 59, 0.7);
        }

        .breathing-container h1 {
            color: var(--primary-color);
        }

        .btn {
            background-color: var(--highlight-color);
            transition: background-color 0.2s, transform 0.1s;
        }

        .btn:hover {
            background-color: #2563eb;
            transform: scale(1.02);
        }

        .btn:disabled {
            background-color: #4b5563;
            cursor: not-allowed;
            transform: none;
        }

        /* The orb that will be animated */
        #breathing-orb {
            width: 150px;
            height: 150px;
            background-color: #38bdf8;
            border-radius: 50%;
            transition: all linear;
            box-shadow: 0 0 10px #38bdf8, 0 0 20px #38bdf8, 0 0 30px #38bdf8;
            transform: scale(0.6);
            position: relative;
        }

        /* Keyframes for the breathing animations */
        @keyframes breathe-in {
            from {
                transform: scale(0.6);
            }
            to {
                transform: scale(1.1);
            }
        }

        @keyframes hold {
            from, to {
                transform: scale(1.1);
            }
        }

        @keyframes breathe-out {
            from {
                transform: scale(1.1);
            }
            to {
                transform: scale(0.6);
            }
        }
    </style>
</head>

<body class="flex items-center justify-center p-4">

    <!-- The Animated Background -->
    <div class="animated-background"></div>

    <div class="breathing-container w-full max-w-md rounded-xl p-8 shadow-2xl backdrop-blur-sm border border-gray-700">
        <h1 class="text-3xl md:text-4xl font-bold mb-6 text-center">Guided Breathing</h1>

        <!-- User Input Section -->
        <div id="setup-section" class="space-y-4 text-center">
            <p class="text-lg pt-4">Number of cycles:</p>
            <input type="number" id="cycles-input" value="5" min="1"
                class="w-full p-3 rounded-lg bg-gray-700 text-white text-center text-xl focus:outline-none focus:ring-2 focus:ring-highlight-color">
            <button id="start-btn" class="btn w-full p-3 rounded-lg font-semibold text-white text-lg">
                Start Exercise
            </button>
        </div>

        <!-- Timer and Instructions Section -->
        <div id="exercise-section" class="hidden text-center space-y-8">
            <div class="flex flex-col items-center justify-center">
                <p id="instruction-text" class="text-2xl font-semibold text-highlight-color">
                    Get ready...
                </p>
                <p id="message-text" class="text-sm text-gray-400 min-h-[1.5rem] mt-2">Cycle 1 of 5</p>
                <div class="flex items-center justify-center relative mt-8">
                    <!-- The new pulsing orb -->
                    <div id="breathing-orb" class="flex items-center justify-center">
                    </div>
                    <div id="timer-display" class="absolute text-3xl font-bold text-white z-20"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM element references
            const startBtn = document.getElementById('start-btn');
            const cyclesInput = document.getElementById('cycles-input');
            const setupSection = document.getElementById('setup-section');
            const exerciseSection = document.getElementById('exercise-section');
            const instructionText = document.getElementById('instruction-text');
            const timerDisplay = document.getElementById('timer-display');
            const messageText = document.getElementById('message-text');
            const breathingOrb = document.getElementById('breathing-orb');

            let totalCycles = 0;
            let currentCycle = 0;
            let currentPhaseIndex = 0;
            let timerInterval;

            // Hardcoded phases with new timings
            const PHASES = [
                { instruction: "Inhale slowly", duration: 6, animationClass: "breathe-in" },
                { instruction: "Hold", duration: 3.5, animationClass: "hold" },
                { instruction: "Exhale slowly", duration: 8, animationClass: "breathe-out" }
            ];

            // Facts about breathing and meditation
            const MEDITATION_FACTS = [
                "Just five minutes of mindful breathing can reduce stress and lower cortisol levels.",
                "Deep breathing activates the vagus nerve, which helps calm your nervous system.",
                "Regular meditation can improve focus and attention span, making you more productive.",
                "Breathing exercises can help lower blood pressure and improve cardiovascular health.",
                "Mindfulness practice can increase gray matter in the brain, improving memory and emotional regulation."
            ];

            function getRandomFact() {
                const randomIndex = Math.floor(Math.random() * MEDITATION_FACTS.length);
                return MEDITATION_FACTS[randomIndex];
            }

            function validateInputs() {
                const cycles = parseInt(cyclesInput.value, 10);

                if (isNaN(cycles) || cycles <= 0) {
                    messageText.textContent = "Please enter a valid, positive number of cycles.";
                    return null;
                }

                return { cycles: cycles };
            }

            function resetUI() {
                clearInterval(timerInterval);
                setupSection.classList.remove('hidden');
                exerciseSection.classList.add('hidden');
                cyclesInput.disabled = false;
                startBtn.disabled = false;
                messageText.textContent = "";
                breathingOrb.style.animation = ''; // Clear any remaining animation
            }

            startBtn.addEventListener('click', () => {
                const inputs = validateInputs();
                if (inputs === null) return;
                totalCycles = inputs.cycles;
                currentCycle = 0;
                startVisualExercise();
            });

            // --- Visual Timer Logic ---
            function startVisualExercise() {
                // Switch UI from setup to exercise mode
                setupSection.classList.add('hidden');
                exerciseSection.classList.remove('hidden');
                cyclesInput.disabled = true;
                startBtn.disabled = true;
                currentCycle = 0;
                runNextCycle();
            }

            function runNextCycle() {
                currentCycle++;
                if (currentCycle > totalCycles) {
                    // Exercise complete
                    instructionText.textContent = "Exercise Complete!";
                    timerDisplay.textContent = "ðŸ¥³";
                    messageText.textContent = getRandomFact();
                    breathingOrb.style.animation = ''; // Final state clear
                    setTimeout(resetUI, 5000);
                    return;
                }
                currentPhaseIndex = 0;
                runPhase();
            }

            function runPhase() {
                const phase = PHASES[currentPhaseIndex];
                instructionText.textContent = phase.instruction;

                // Only show cycle count
                messageText.textContent = `Cycle ${currentCycle} of ${totalCycles}`;

                clearInterval(timerInterval);

                // Set animation and duration on the orb
                breathingOrb.style.animation = `${phase.animationClass} ${phase.duration}s forwards linear`;

                let startTime = Date.now();
                const totalDuration = phase.duration * 1000;

                timerInterval = setInterval(() => {
                    const elapsedTime = Date.now() - startTime;
                    const secondsLeft = Math.ceil((totalDuration - elapsedTime) / 1000);
                    if (secondsLeft >= 0) {
                        timerDisplay.textContent = secondsLeft;
                    }
                    if (elapsedTime >= totalDuration) {
                        clearInterval(timerInterval);
                        breathingOrb.style.animation = '';
                        currentPhaseIndex++;
                        if (currentPhaseIndex < PHASES.length) {
                            runPhase(); // Run next phase in the cycle
                        } else {
                            runNextCycle();
                        }
                    }
                }, 100);
            }
        });
    </script>
</body>

</html>
